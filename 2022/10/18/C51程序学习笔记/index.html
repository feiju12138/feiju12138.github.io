<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon-package/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-package/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-package/favicon-16x16.png">
  <link rel="mask-icon" href="/assets/images/favicon-package/safari-pinned-tab.svg" color="#222">
  <link rel="manifest" href="/assets/images/favicon-package/site.webmanifest">
  <meta name="google-site-verification" content="qIz-Tg08U6gyN_53z89yii0ZmKx2avfsO-iyOWhsRx8">
  <meta name="msvalidate.01" content="096F3D01D2AA04148F10750CD4566535">
  <meta name="yandex-verification" content="43f790b7e38394a4">
  <meta name="baidu-site-verification" content="codeva-LMZoUaXjJl">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"loli.fj.cn","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.23.2","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-light","dark":"atom-one-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"language":true},"bookmark":{"enable":true,"color":"#222","save":"manual"},"mediumzoom":true,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="前言Windows上标准51单片机的C51学习笔记注意：本文所有代码均按照sdcc编译器代码规范编写，如果使用的Keli编译器，需要自行修改代码">
<meta property="og:type" content="article">
<meta property="og:title" content="【笔记】C51程序学习笔记">
<meta property="og:url" content="https://loli.fj.cn/2022/10/18/C51%E7%A8%8B%E5%BA%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="57uv6Z6g55qE5Y2a5a6i">
<meta property="og:description" content="前言Windows上标准51单片机的C51学习笔记注意：本文所有代码均按照sdcc编译器代码规范编写，如果使用的Keli编译器，需要自行修改代码">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-10-18T08:33:18.000Z">
<meta property="article:modified_time" content="2025-10-25T07:39:44.842Z">
<meta property="article:author" content="57uv6Z6g">
<meta property="article:tag" content="Microcontroller">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://loli.fj.cn/2022/10/18/C51%E7%A8%8B%E5%BA%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://loli.fj.cn/2022/10/18/C51%E7%A8%8B%E5%BA%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","path":"2022/10/18/C51程序学习笔记/","title":"【笔记】C51程序学习笔记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>【笔记】C51程序学习笔记 | 57uv6Z6g55qE5Y2a5a6i</title>
  






  <script async defer data-website-id="981ed5a0-eea5-4426-a8a9-c16a789ccc3f" src="https://umami.loli.fj.cn/script.js" data-host-url="https://umami.loli.fj.cn/"></script>


  
  <script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script>
  <script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous" defer></script>
  <script src="/lib/pangu/dist/browser/pangu.umd.js" integrity="sha256-erngBMP3zzoIM6eqQ8dmrReh2vqCRgWmORroIfVoDlE=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script><script src="/js/pjax.js" defer></script>

  <script src="/lib/hexo-generator-searchdb/dist/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"/lib/mathjax/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="57uv6Z6g55qE5Y2a5a6i" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">57uv6Z6g55qE5Y2a5a6i</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">MS4wLjABAAAA5qMD8Gzdcgq7HXUOviKB59i0-ybJ59jJvNzyaPt5XOsVNqP6DU7WLcoAXvdxvYdp💗<br><font color="red">本站所有文章仅作技术研究，请勿非法破坏，请遵守相关法律法规，后果自负</font></p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-reward"><a href="/reward/" rel="section"><i class="fa fa-hand-holding-heart fa-fw"></i>赞助</a></li><li class="menu-item menu-item-command"><a href="/command/" rel="section"><i class="fa fa-book fa-fw"></i>指令</a></li><li class="menu-item menu-item-contribute"><a href="/contribute/" rel="section"><i class="fa fa-chart-line fa-fw"></i>贡献</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>订阅</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

<link rel="manifest" href="/assets/images/favicon-package/site.webmanifest">

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4%E7%9A%84%E8%AE%BF%E9%97%AE"><span class="nav-number">2.</span> <span class="nav-text">存储空间的访问</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C2%E8%BF%9B%E5%88%B6%E4%BD%8D"><span class="nav-number">3.</span> <span class="nav-text">操作2进制位</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E4%BD%8D%E4%B8%BA0"><span class="nav-number">3.1.</span> <span class="nav-text">指定位为0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E4%BD%8D%E4%B8%BA1"><span class="nav-number">3.2.</span> <span class="nav-text">指定位为1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E4%BD%8D%E5%8F%96%E5%8F%8D"><span class="nav-number">3.3.</span> <span class="nav-text">指定位取反</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BA%E5%AE%9A%E6%A0%BC%E5%BC%8F"><span class="nav-number">4.</span> <span class="nav-text">固定格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E5%85%A5%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="nav-number">5.</span> <span class="nav-text">引入头文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E5%BC%95%E8%84%9A%E8%B5%8B%E5%80%BC"><span class="nav-number">6.</span> <span class="nav-text">为引脚赋值</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%89%E5%AD%97%E8%8A%82%E8%B5%8B%E5%80%BC"><span class="nav-number">6.1.</span> <span class="nav-text">按字节赋值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%89%E4%BD%8D%E8%B5%8B%E5%80%BC"><span class="nav-number">6.2.</span> <span class="nav-text">按位赋值</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%E6%8F%90%E5%8D%87%E6%95%88%E7%8E%87"><span class="nav-number">7.</span> <span class="nav-text">循环语句提升效率</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%91%E5%85%89%E4%BA%8C%E6%9E%81%E7%AE%A1"><span class="nav-number">8.</span> <span class="nav-text">发光二极管</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%89%E7%94%B5%E6%B5%81%E5%92%8C%E7%81%8C%E7%94%B5%E6%B5%81"><span class="nav-number">8.1.</span> <span class="nav-text">拉电流和灌电流</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8B%89%E7%94%B5%E6%B5%81"><span class="nav-number">8.1.1.</span> <span class="nav-text">拉电流</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%81%8C%E7%94%B5%E6%B5%81"><span class="nav-number">8.1.2.</span> <span class="nav-text">灌电流</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AF%E4%BB%B6%E5%BB%B6%E8%BF%9F%E5%87%BD%E6%95%B0"><span class="nav-number">8.2.</span> <span class="nav-text">软件延迟函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E5%BB%B6%E8%BF%9F%E5%AE%9E%E7%8E%B0%E9%97%AA%E7%83%81"><span class="nav-number">8.3.</span> <span class="nav-text">通过延迟实现闪烁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E8%B0%83%E6%95%B4%E5%8D%A0%E7%A9%BA%E6%AF%94%E6%94%B9%E5%8F%98%E4%BA%AE%E5%BA%A6"><span class="nav-number">8.4.</span> <span class="nav-text">通过调整占空比改变亮度</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#STC12C5A60S2%E7%9A%84%E7%89%B9%E6%AE%8A%E5%8A%9F%E8%83%BD%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-number">9.</span> <span class="nav-text">STC12C5A60S2的特殊功能寄存器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E5%85%A5%E5%A4%B4%E6%96%87%E4%BB%B6-1"><span class="nav-number">9.1.</span> <span class="nav-text">引入头文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E6%8D%A2%E7%AB%AF%E5%8F%A3%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="nav-number">9.2.</span> <span class="nav-text">切换端口工作模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="nav-number">9.2.1.</span> <span class="nav-text">工作模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E6%96%B9%E6%B3%95"><span class="nav-number">9.2.2.</span> <span class="nav-text">设置方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%89%E9%94%AE"><span class="nav-number">10.</span> <span class="nav-text">按键</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AF%E4%BB%B6%E6%B6%88%E6%8A%96"><span class="nav-number">10.1.</span> <span class="nav-text">软件消抖</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%89%E4%B8%8B%E5%90%8E%E6%89%A7%E8%A1%8C%E4%B8%9A%E5%8A%A1"><span class="nav-number">10.1.1.</span> <span class="nav-text">按下后执行业务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%AC%E8%B5%B7%E5%90%8E%E6%89%A7%E8%A1%8C%E4%B8%9A%E5%8A%A1"><span class="nav-number">10.1.2.</span> <span class="nav-text">抬起后执行业务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%89%E9%94%AE%E6%A3%80%E6%B5%8B%E5%87%BD%E6%95%B0"><span class="nav-number">10.2.</span> <span class="nav-text">按键检测函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E6%AE%B5%E6%95%B0%E7%A0%81%E7%AE%A1"><span class="nav-number">11.</span> <span class="nav-text">七段数码管</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E9%83%A8%E7%82%B9%E4%BA%AE"><span class="nav-number">11.1.</span> <span class="nav-text">全部点亮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E4%B8%BA%E5%87%BD%E6%95%B0"><span class="nav-number">11.2.</span> <span class="nav-text">封装为函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%82%B9%E9%98%B5%E5%B1%8F"><span class="nav-number">12.</span> <span class="nav-text">点阵屏</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E5%B1%8F"><span class="nav-number">12.1.</span> <span class="nav-text">单屏</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A8%E9%83%A8%E7%82%B9%E4%BA%AE-1"><span class="nav-number">12.1.1.</span> <span class="nav-text">全部点亮</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8C%E5%B1%8F"><span class="nav-number">12.2.</span> <span class="nav-text">双屏</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A8%E9%83%A8%E7%82%B9%E4%BA%AE-2"><span class="nav-number">12.2.1.</span> <span class="nav-text">全部点亮</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%9C%82%E9%B8%A3%E5%99%A8%EF%BC%88Buzz%EF%BC%89"><span class="nav-number">13.</span> <span class="nav-text">蜂鸣器（Buzz）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AF%E4%BB%B6%E5%BB%B6%E8%BF%9F%E5%AE%9E%E7%8E%B0%E8%9C%82%E9%B8%A3%E5%99%A85Hz%E5%A3%B0%E9%9F%B3"><span class="nav-number">13.1.</span> <span class="nav-text">软件延迟实现蜂鸣器5Hz声音</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E6%97%B6-%E8%AE%A1%E6%95%B0%E5%99%A8%E5%AE%9E%E7%8E%B0%E8%9C%82%E9%B8%A3%E5%99%A8500Hz%E5%A3%B0%E9%9F%B3"><span class="nav-number">13.2.</span> <span class="nav-text">定时&#x2F;计数器实现蜂鸣器500Hz声音</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E6%97%B6-%E8%AE%A1%E6%95%B0%E5%99%A8%E5%AE%9E%E7%8E%B0%E8%9C%82%E9%B8%A3%E5%99%A8%E6%8C%87%E5%AE%9A%E9%A2%91%E7%8E%87%E5%A3%B0%E9%9F%B3"><span class="nav-number">13.3.</span> <span class="nav-text">定时&#x2F;计数器实现蜂鸣器指定频率声音</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E6%97%B6-%E8%AE%A1%E6%95%B0%E5%99%A8%E5%AE%9E%E7%8E%B0%E8%9C%82%E9%B8%A3%E5%99%A8%E9%9F%B3%E9%98%B6"><span class="nav-number">13.4.</span> <span class="nav-text">定时&#x2F;计数器实现蜂鸣器音阶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#C%E5%A4%A7%E8%B0%83%E9%9F%B3%E7%AC%A6%E9%A2%91%E7%8E%87%E5%AF%B9%E7%85%A7%E8%A1%A8"><span class="nav-number">13.4.1.</span> <span class="nav-text">C大调音符频率对照表</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E6%88%90"><span class="nav-number">14.</span> <span class="nav-text">完成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="nav-number">15.</span> <span class="nav-text">参考文献</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="57uv6Z6g"
      src="/assets/images/avatar.gif">
  <p class="site-author-name" itemprop="name">57uv6Z6g</p>
  <div class="site-description" itemprop="description">5o2V5o2J5LiA5Y+q54ix5oqY6IW+55qE57uv6Z6g</div>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="mailto:00-isomer-cabbies@icloud.com" title="E-Mail → mailto:00-isomer-cabbies@icloud.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/LittleSweetCookie" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;LittleSweetCookie" rel="noopener me" target="_blank"><i class="fab fa-telegram fa-fw"></i>Telegram</a>
      </span>
  </div>

<div id="aplayer-app"></div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://loli.fj.cn/2022/10/18/C51%E7%A8%8B%E5%BA%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/images/avatar.gif">
      <meta itemprop="name" content="57uv6Z6g">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="57uv6Z6g55qE5Y2a5a6i">
      <meta itemprop="description" content="5o2V5o2J5LiA5Y+q54ix5oqY6IW+55qE57uv6Z6g">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="【笔记】C51程序学习笔记 | 57uv6Z6g55qE5Y2a5a6i">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【笔记】C51程序学习笔记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-10-18 16:33:18" itemprop="dateCreated datePublished" datetime="2022-10-18T16:33:18+08:00">2022-10-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-10-25 15:39:44" itemprop="dateModified" datetime="2025-10-25T15:39:44+08:00">2025-10-25</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Windows上标准51单片机的C51学习笔记<br>注意：本文所有代码均按照sdcc编译器代码规范编写，如果使用的Keli编译器，需要自行修改代码</p>
<span id="more"></span>

<h2 id="存储空间的访问"><a href="#存储空间的访问" class="headerlink" title="存储空间的访问"></a>存储空间的访问</h2><ul>
<li><p>单片机有两个存储器，分别是：只读存储器ROM、随机存储器RAM</p>
<ul>
<li>ROM：通常用于存程序（code）</li>
<li>RAM：通常用于存数据（data）</li>
</ul>
</li>
<li><p>51单片机存储器的空间</p>
<ul>
<li>标准51单片机<ul>
<li>ROM空间为4KB</li>
<li>RAM空间为128B</li>
</ul>
</li>
<li>STC12C5A60S2单片机<ul>
<li>ROM空间（4KB）+外扩内存（56KB）总共为60KB</li>
<li>RAM空间为1280B</li>
</ul>
</li>
</ul>
</li>
<li><p>C语言中的变量值将会默认存入RAM</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>因为RAM容量较小，所以如果有大量数据需要存储（例如数组），可以通过<code>code</code>关键字强制将变量的值存入ROM</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__code <span class="type">int</span> a = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果使用的是增强型51单片机（例如STC12C5A60S2单片机），可以通过<code>xdata</code>关键字强制将变量的值存入外扩内存</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__xdata <span class="type">int</span> a = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h2 id="操作2进制位"><a href="#操作2进制位" class="headerlink" title="操作2进制位"></a>操作2进制位</h2><ul>
<li>在操作2进制位时，如果需要改变2进制位，通常不使用算术运算符，通常使用<a href="/2022/11/04/C%E8%AF%AD%E8%A8%80%E6%8C%89%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/">按位运算符</a></li>
</ul>
<h3 id="指定位为0"><a href="#指定位为0" class="headerlink" title="指定位为0"></a>指定位为0</h3><ul>
<li>任意位与0相<strong>与</strong>，结果<strong>不变</strong></li>
<li>任意位与1相<strong>与</strong>，结果为<strong>0</strong></li>
</ul>
<p>举例：将末位置0</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num = num &amp; <span class="number">0b00000001</span>;</span><br></pre></td></tr></table></figure>

<h3 id="指定位为1"><a href="#指定位为1" class="headerlink" title="指定位为1"></a>指定位为1</h3><ul>
<li>任意位与0相<strong>或</strong>，结果<strong>不变</strong></li>
<li>任意位与1相<strong>或</strong>，结果为<strong>1</strong></li>
</ul>
<p>举例：将末位置1</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num = num | <span class="number">0b00000001</span>;</span><br></pre></td></tr></table></figure>

<h3 id="指定位取反"><a href="#指定位取反" class="headerlink" title="指定位取反"></a>指定位取反</h3><ul>
<li>任意位与0<strong>异或</strong>，结果<strong>不变</strong></li>
<li>任意位与1<strong>异或</strong>，结果<strong>取反</strong></li>
</ul>
<p>举例：将末位置取反</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num = num ^ <span class="number">0b00000001</span>;</span><br></pre></td></tr></table></figure>

<h2 id="固定格式"><a href="#固定格式" class="headerlink" title="固定格式"></a>固定格式</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;reg52.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="引入头文件"><a href="#引入头文件" class="headerlink" title="引入头文件"></a>引入头文件</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="为引脚赋值"><a href="#为引脚赋值" class="headerlink" title="为引脚赋值"></a>为引脚赋值</h2><ul>
<li>I&#x2F;O端口都是可以位寻址的，所以既可以按字节赋值，也可以按位赋值</li>
</ul>
<h3 id="按字节赋值"><a href="#按字节赋值" class="headerlink" title="按字节赋值"></a>按字节赋值</h3><ul>
<li>将P0的所有引脚都通电（<code>00000000</code>）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P0 = <span class="number">0x00</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>将P0的所有引脚都断电（<code>11111111</code>）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P0 = <span class="number">0xFF</span>;</span><br></pre></td></tr></table></figure>


<h3 id="按位赋值"><a href="#按位赋值" class="headerlink" title="按位赋值"></a>按位赋值</h3><ul>
<li>将P0的第1个引脚通电（<code>11111110</code>）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P0_0 = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>将P0的第1个引脚断电（<code>11111111</code>）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P0_0 = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="循环语句提升效率"><a href="#循环语句提升效率" class="headerlink" title="循环语句提升效率"></a>循环语句提升效率</h2><ul>
<li>循环要以递减的方式迭代。在编译成汇编代码后，递减的方式迭代要比递增的方式迭代执行效率更高</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">while</span> (i &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    i--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">100</span>; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="发光二极管"><a href="#发光二极管" class="headerlink" title="发光二极管"></a>发光二极管</h2><ul>
<li>发光二极管是一个输出外设</li>
</ul>
<h3 id="拉电流和灌电流"><a href="#拉电流和灌电流" class="headerlink" title="拉电流和灌电流"></a>拉电流和灌电流</h3><h4 id="拉电流"><a href="#拉电流" class="headerlink" title="拉电流"></a>拉电流</h4><ul>
<li>拉电流时<ul>
<li>输入为<strong>1</strong>时，发光二极管<strong>亮灯</strong></li>
<li>输入为<strong>0</strong>时，发光二极管<strong>不亮灯</strong></li>
</ul>
</li>
<li>拉电流为200微安</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">单片机引脚 &lt;- 发光二极管正级</span><br><span class="line">发光二极管负级 -&gt; 限流电阻 -&gt; 电源负级</span><br></pre></td></tr></table></figure>

<h4 id="灌电流"><a href="#灌电流" class="headerlink" title="灌电流"></a>灌电流</h4><ul>
<li>灌电流时<ul>
<li>输入为<strong>0</strong>时，发光二极管<strong>亮灯</strong></li>
<li>输入为<strong>1</strong>时，发光二极管<strong>不亮灯</strong></li>
</ul>
</li>
<li>灌电流为20毫安，所以通常使用灌电流，才能让发光二极管达到正常亮度</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">单片机引脚 &lt;- 限流电阻 &lt;- 发光二极管负级</span><br><span class="line">发光二极管正级 -&gt; 电源正级</span><br></pre></td></tr></table></figure>

<h3 id="软件延迟函数"><a href="#软件延迟函数" class="headerlink" title="软件延迟函数"></a>软件延迟函数</h3><ul>
<li>通过600~700次的空循环，可以实现延迟1ms左右</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通过延迟实现闪烁"><a href="#通过延迟实现闪烁" class="headerlink" title="通过延迟实现闪烁"></a>通过延迟实现闪烁</h3><ul>
<li>频率越高闪烁越快</li>
<li>每1s内，实现1次亮和1次灭，这样的频率为1Hz</li>
<li>因为人眼有余晖时间，所以人眼可识别的最大闪烁频率为50Hz</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 闪烁频率为50Hz（1秒钟闪烁50次）</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> time = <span class="number">1</span>;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> count = <span class="number">50</span>;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> delay_time = <span class="number">1000</span> * time / <span class="number">2</span> / count;</span><br><span class="line">        P1_0 = <span class="number">0</span>;</span><br><span class="line">        delay(delay_time);</span><br><span class="line">        P1_0 = <span class="number">1</span>;</span><br><span class="line">        delay(delay_time);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通过调整占空比改变亮度"><a href="#通过调整占空比改变亮度" class="headerlink" title="通过调整占空比改变亮度"></a>通过调整占空比改变亮度</h3><ul>
<li>亮度的决定因素：发光二极管闪烁时，亮的时间越大，灭的时间越小，亮度越亮</li>
<li>占空比：灭的时间 &#x2F; 亮的时间 + 灭的时间</li>
<li>当亮和灭的时间间隔发生改变时，占空比就会改变，发光二极管亮度就会改变</li>
<li>50Hz在1秒内的的两次间隔之和为20ms，所以能产生19级亮度<ul>
<li>当亮1ms，灭19ms，亮度最暗</li>
<li>当亮19ms，灭1ms，亮度最亮</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 亮度最亮</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">max</span><span class="params">()</span> &#123;</span><br><span class="line">    P1_0 = <span class="number">0</span>;</span><br><span class="line">    delay(<span class="number">19</span>);</span><br><span class="line">    P1_0 = <span class="number">1</span>;</span><br><span class="line">    delay(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 亮度最暗</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">mim</span><span class="params">()</span> &#123;</span><br><span class="line">    P1_0 = <span class="number">0</span>;</span><br><span class="line">    delay(<span class="number">1</span>);</span><br><span class="line">    P1_0 = <span class="number">1</span>;</span><br><span class="line">    delay(<span class="number">19</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="STC12C5A60S2的特殊功能寄存器"><a href="#STC12C5A60S2的特殊功能寄存器" class="headerlink" title="STC12C5A60S2的特殊功能寄存器"></a>STC12C5A60S2的特殊功能寄存器</h2><h3 id="引入头文件-1"><a href="#引入头文件-1" class="headerlink" title="引入头文件"></a>引入头文件</h3><p><a href="/2022/10/28/STC12C5A60S2%E5%A4%B4%E6%96%87%E4%BB%B6%E6%BA%90%E4%BB%A3%E7%A0%81/">传送门</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;STC12C5A60S2.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="切换端口工作模式"><a href="#切换端口工作模式" class="headerlink" title="切换端口工作模式"></a>切换端口工作模式</h3><ul>
<li>以修改P0端口的第0个位置为例</li>
</ul>
<h4 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h4><table>
<thead>
<tr>
<th>工作模式</th>
<th>M1寄存器的值</th>
<th>M0寄存器的值</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>标准双向口模式（缺省值）</td>
<td>0</td>
<td>0</td>
<td>灌电流为20毫安，拉电流为200微安</td>
</tr>
<tr>
<td>强推挽输出模式（强推模式）</td>
<td>0</td>
<td>1</td>
<td>灌电流为20毫安，拉电流提升为20毫安</td>
</tr>
<tr>
<td>开漏模式</td>
<td>1</td>
<td>0</td>
<td>-</td>
</tr>
<tr>
<td>高阻模式</td>
<td>1</td>
<td>1</td>
<td>-</td>
</tr>
</tbody></table>
<h4 id="设置方法"><a href="#设置方法" class="headerlink" title="设置方法"></a>设置方法</h4><ul>
<li>每个位可以单独设置工作模式，由2个寄存器对应位的值决定</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">P0M1 = <span class="number">0x00</span>;</span><br><span class="line">P0M0 = <span class="number">0x00</span>;</span><br></pre></td></tr></table></figure>

<h2 id="按键"><a href="#按键" class="headerlink" title="按键"></a>按键</h2><ul>
<li><p>按键是一个输入外设</p>
</li>
<li><p>按键<strong>按下</strong>时，输入为<strong>0</strong></p>
</li>
<li><p>按键<strong>没有按下</strong>时，输入为<strong>1</strong></p>
</li>
</ul>
<h3 id="软件消抖"><a href="#软件消抖" class="headerlink" title="软件消抖"></a>软件消抖</h3><ul>
<li>按键按下和抬起时，会有抖动现象产生，抖动现象通常会在按下和抬起的10ms~20ms之间发生</li>
<li>软件消抖通过利用软件延迟函数实现</li>
<li>软件消抖的效果<ul>
<li>按下消抖效果：按下时进入循环，此时通过延迟10ms，解决10ms之内按下瞬间出现反复按的情况。</li>
<li>抬起消抖效果：如果按住并且一直没抬起，此时会进入无限循环，也就是不会做处理。抬起时通过延迟10ms，解决10ms之内按下瞬间出现反复按的情况</li>
</ul>
</li>
</ul>
<h4 id="按下后执行业务"><a href="#按下后执行业务" class="headerlink" title="按下后执行业务"></a>按下后执行业务</h4><blockquote>
<p><code>P0_0</code>：按键的连接点</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) </span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="keyword">while</span> (!P0_0)</span><br><span class="line">        &#123;   </span><br><span class="line">            <span class="comment">// 按下消抖</span></span><br><span class="line">            delay(<span class="number">10</span>);</span><br><span class="line">            <span class="keyword">if</span> (!P0_0)</span><br><span class="line">            &#123;   </span><br><span class="line">                <span class="comment">// 业务代码</span></span><br><span class="line">                ...</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 抬起消抖</span></span><br><span class="line">            <span class="keyword">while</span> (!P0_0);</span><br><span class="line">            delay(<span class="number">10</span>);</span><br><span class="line">        &#125;   </span><br><span class="line"></span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="抬起后执行业务"><a href="#抬起后执行业务" class="headerlink" title="抬起后执行业务"></a>抬起后执行业务</h4><blockquote>
<p><code>P0_0</code>：按键的连接点</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) </span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="keyword">while</span> (!P0_0)</span><br><span class="line">        &#123;   </span><br><span class="line">            delay(<span class="number">10</span>);</span><br><span class="line">            <span class="keyword">while</span> (!P0_0);</span><br><span class="line">            delay(<span class="number">10</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 业务代码</span></span><br><span class="line">            ...</span><br><span class="line">        &#125;   </span><br><span class="line"></span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="按键检测函数"><a href="#按键检测函数" class="headerlink" title="按键检测函数"></a>按键检测函数</h3><ul>
<li>为每一个按键按下赋予键值，在主函数中通过判断减值，实现指定业务</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include&lt;8052.h&gt;</span></span><br><span class="line"></span><br><span class="line">void delay(unsigned int ms)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int j;</span><br><span class="line">    while (ms--)</span><br><span class="line">        for (j = 600; j &gt; 0; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsigned char key_scan(void)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char key_num = 0;</span><br><span class="line">    if (!P0_0 || !P0_1)</span><br><span class="line">    &#123;   </span><br><span class="line">        delay(10);</span><br><span class="line">        if (!P0_0) key_num = 1;</span><br><span class="line">        if (!P0_1) key_num = 2;</span><br><span class="line">        while (!P0_0 || !P0_1);</span><br><span class="line">        delay(10);</span><br><span class="line">    &#125;   </span><br><span class="line">    return key_num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">    while (1) </span><br><span class="line">    &#123;   </span><br><span class="line">        switch (key_scan())</span><br><span class="line">        &#123;   </span><br><span class="line">            case 1:</span><br><span class="line">                // 业务代码</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                // 业务代码</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七段数码管"><a href="#七段数码管" class="headerlink" title="七段数码管"></a>七段数码管</h2><ul>
<li><p>数码管的引脚一般都在上下，共阴和共阳是由内部决定的</p>
</li>
<li><p>共阳数码管（灌电流）点亮：位信号（com端）接高电平，段信号（a、b、c、d、e、f、g、dp端）接低电平</p>
<ul>
<li>本案例接线方式<ul>
<li>位信号1接P0.3、…、位信号4接P0.0</li>
<li>段信号a接P1.0、…、段信号g接P1.6、段信号dep接P1.7</li>
</ul>
</li>
</ul>
</li>
<li><p>共阴数码管（拉电流）点亮：位信号（com端）接低电平，段信号（a、b、c、d、e、f、g、dp端）接高电平</p>
</li>
<li><p>不应该将位信号同时点亮，如果需要全部点亮每个位，可以采用动态刷新技术</p>
</li>
<li><p>不同位数的七段数码管</p>
<ul>
<li>1位七段数码管一共有10个引脚<ul>
<li>2个com端（这两个引脚内部是想通的）</li>
<li>a（上）、b（右上）、c（右下）、d（下）、e（左下）、f（左上）、g（中）、dp（小数点）端</li>
</ul>
</li>
<li>2位七段数码管一共有10个引脚<ul>
<li>com1端、com2端</li>
<li>a（上）、b（右上）、c（右下）、d（下）、e（左下）、f（左上）、g（中）、dp（小数点）端</li>
</ul>
</li>
<li>N位七段数码管一共有<code>(8+N)</code>个引脚<ul>
<li>com1端、…、comN端</li>
<li>a（上）、b（右上）、c（右下）、d（下）、e（左下）、f（左上）、g（中）、dp（小数点）端</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="全部点亮"><a href="#全部点亮" class="headerlink" title="全部点亮"></a>全部点亮</h3><ul>
<li>通过动态扫描（刷新），实现全部点亮检查坏点：通过快速切换不同位上的数字，实现现实多个位上的数字扫描<ul>
<li>因为人眼能识别的最大闪烁频率为50Hz，所以为了骗过人眼，需要将所有数字在20ms内完成闪烁</li>
</ul>
</li>
<li>七段码：每个数字位用于显示数字的16进制值，16进制数的每一位决定哪一个笔划亮灯<ul>
<li>从com端到a~dep端如果是灌电流，则com端输出<strong>0</strong>时，数码管指定位<strong>亮灯</strong></li>
</ul>
</li>
</ul>
<ol>
<li>选位：选位阶段需要指定哪个位亮</li>
<li>送段：送出段信号阶段需要指定亮哪个数字</li>
<li>延迟：如果是4位数码管，每个位的延迟应设置为5ms</li>
<li>灭段：为了解决拖影（拖尾）现象，将亮灯的数字熄灭</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__sfr __at (<span class="number">0x94</span>) P0M0;</span><br><span class="line">__sfr __at (<span class="number">0x93</span>) P0M1;</span><br><span class="line">__sfr __at (<span class="number">0x92</span>) P1M0;</span><br><span class="line">__sfr __at (<span class="number">0x91</span>) P1M1;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 强推挽输出模式</span></span><br><span class="line">    P0M1 = <span class="number">0x00</span>;</span><br><span class="line">    P0M0 = <span class="number">0xFF</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义七段码</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> num[] = &#123;<span class="number">0xC0</span>, <span class="number">0xEC</span>, <span class="number">0x92</span>, <span class="number">0x98</span>,<span class="number">0xCC</span>, <span class="number">0x89</span>, <span class="number">0x81</span>, <span class="number">0xDC</span>, <span class="number">0x80</span>, <span class="number">0x88</span>&#125;;</span><br><span class="line">    <span class="comment">// 定义位</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> w[] = &#123;<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">char</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            P0 = w[i]; <span class="comment">// 选位</span></span><br><span class="line">            P1 = num[<span class="number">8</span>]; <span class="comment">// 送段</span></span><br><span class="line">            delay(<span class="number">5</span>); <span class="comment">// 延迟</span></span><br><span class="line">            P1 = <span class="number">0xFF</span>; <span class="comment">// 灭段</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="封装为函数"><a href="#封装为函数" class="headerlink" title="封装为函数"></a>封装为函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">display</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *arr)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义计数器</span></span><br><span class="line">    <span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 定义七段码</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> num[] = &#123;<span class="number">0xC0</span>, <span class="number">0xEC</span>, <span class="number">0x92</span>, <span class="number">0x98</span>,<span class="number">0xCC</span>, <span class="number">0x89</span>, <span class="number">0x81</span>, <span class="number">0xDC</span>, <span class="number">0x80</span>, <span class="number">0x88</span>&#125;;</span><br><span class="line">    P0 = <span class="number">0x01</span> &lt;&lt; i;</span><br><span class="line">    P1 = num[arr[i]];</span><br><span class="line">    delay(<span class="number">5</span>);</span><br><span class="line">    P0 = <span class="number">0x00</span>;</span><br><span class="line">    i += <span class="number">1</span>;</span><br><span class="line">    i %= <span class="number">4</span>;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> arr[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        display(arr);</span><br><span class="line">        delay(<span class="number">2</span>);            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="点阵屏"><a href="#点阵屏" class="headerlink" title="点阵屏"></a>点阵屏</h2><ul>
<li><p>8（列）*8（行）的点阵屏的操作逻辑与8位数码管理论上相同</p>
</li>
<li><p>分辨率：8（列）*8（行）</p>
</li>
<li><p>像素：64</p>
</li>
<li><p>点阵屏的引脚是由方向决定的，共阴和共阳也是由方向决定的</p>
</li>
<li><p>共阳（灌电流）接线方式（引脚在左右）点亮：列信号接高电平（高选列），行信号接低电平（低送行）</p>
</li>
<li><p>共阴（拉电流）接线方式（引脚在上下）点亮：列信号接低电平（低选列），行信号接高电平（高送行）</p>
<ul>
<li>本案例接线方式（单屏）<ul>
<li>列信号1接P0.0、…、位信号8接P0.7</li>
<li>行信号1接P1.0、…、段信号8接P1.7</li>
</ul>
</li>
<li>本案例接线方式（多屏）<ul>
<li>列信号1接P0.0、…、位信号8接P0.7</li>
<li>列信号9接P2.0、…、位信号16接P2.7</li>
<li>行信号1接P1.0、…、段信号8接P1.7</li>
</ul>
</li>
</ul>
</li>
<li><p>不应该将列信号同时点亮，如果需要全部点亮每个列，可以采用动态刷新技术</p>
</li>
<li><p>取模：将文字转化成点阵</p>
<ul>
<li>汉字的字模需要最少12*12的分辨率才能正常显示</li>
</ul>
</li>
<li><p>切屏：每次刷新8列</p>
</li>
<li><p>滚屏：每次刷新1列</p>
</li>
</ul>
<h3 id="单屏"><a href="#单屏" class="headerlink" title="单屏"></a>单屏</h3><h4 id="全部点亮-1"><a href="#全部点亮-1" class="headerlink" title="全部点亮"></a>全部点亮</h4><ul>
<li>通过动态扫描（刷新）全部点亮，检查是否坏点</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__sfr __at (<span class="number">0x94</span>) P0M0;</span><br><span class="line">__sfr __at (<span class="number">0x93</span>) P0M1;</span><br><span class="line">__sfr __at (<span class="number">0x92</span>) P1M0;</span><br><span class="line">__sfr __at (<span class="number">0x91</span>) P1M1;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 强推挽输出模式</span></span><br><span class="line">    P0M1 = <span class="number">0x00</span>;</span><br><span class="line">    P0M0 = <span class="number">0xFF</span>;</span><br><span class="line">    </span><br><span class="line">    P1M1 = <span class="number">0x00</span>;</span><br><span class="line">    P1M0 = <span class="number">0xFF</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义字模值</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> num[] = &#123;<span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>&#125;;</span><br><span class="line">    <span class="comment">// 定义列</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> l[] = &#123;<span class="number">0xFE</span>, <span class="number">0xFD</span>, <span class="number">0xFB</span>, <span class="number">0xF7</span>, <span class="number">0xEF</span>, <span class="number">0xDF</span>, <span class="number">0xBF</span>, <span class="number">0x7F</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">char</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            P0 = l[i]; <span class="comment">// 选列</span></span><br><span class="line">            P1 = num[i]; <span class="comment">// 送行</span></span><br><span class="line">            delay(<span class="number">2</span>); <span class="comment">// 延迟</span></span><br><span class="line">            P1 = <span class="number">0xFF</span>; <span class="comment">// 灭行</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="双屏"><a href="#双屏" class="headerlink" title="双屏"></a>双屏</h3><h4 id="全部点亮-2"><a href="#全部点亮-2" class="headerlink" title="全部点亮"></a>全部点亮</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__sfr __at (<span class="number">0x94</span>) P0M0;</span><br><span class="line">__sfr __at (<span class="number">0x93</span>) P0M1;</span><br><span class="line">__sfr __at (<span class="number">0x92</span>) P1M0;</span><br><span class="line">__sfr __at (<span class="number">0x91</span>) P1M1;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 强推挽输出模式</span></span><br><span class="line">    P0M1 = <span class="number">0x00</span>;</span><br><span class="line">    P0M0 = <span class="number">0xFF</span>;</span><br><span class="line">    </span><br><span class="line">    P1M1 = <span class="number">0x00</span>;</span><br><span class="line">    P1M0 = <span class="number">0xFF</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义字模值</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> num[] = &#123;<span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>&#125;;</span><br><span class="line">    <span class="comment">// 定义列</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> l[] = &#123;<span class="number">0xFE</span>, <span class="number">0xFD</span>, <span class="number">0xFB</span>, <span class="number">0xF7</span>, <span class="number">0xEF</span>, <span class="number">0xDF</span>, <span class="number">0xBF</span>, <span class="number">0x7F</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">char</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; <span class="number">8</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                P2 = <span class="number">0xFF</span>;</span><br><span class="line">                P0 = l[i]; <span class="comment">// 选列</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                P0 = <span class="number">0xFF</span>;</span><br><span class="line">                P2 = l[i]; <span class="comment">// 选列</span></span><br><span class="line">            &#125;</span><br><span class="line">            P1 = num[i]; <span class="comment">// 送行</span></span><br><span class="line">            delay(<span class="number">1</span>); <span class="comment">// 延迟</span></span><br><span class="line">            P1 = <span class="number">0xFF</span>; <span class="comment">// 灭行</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="蜂鸣器（Buzz）"><a href="#蜂鸣器（Buzz）" class="headerlink" title="蜂鸣器（Buzz）"></a>蜂鸣器（Buzz）</h2><ul>
<li><p>有源蜂鸣器：内置了震荡源芯片的蜂鸣器，接上电点就能响，但是不能改变振动频率所以只能发出一种音调</p>
</li>
<li><p>无源蜂鸣器：没有内置震荡源芯片的蜂鸣器，接上电后，需要给脉冲信号才能响，可以通过改变震动频发出不同的音调</p>
</li>
<li><p>拉电流和灌电流都可以使蜂鸣器发声</p>
<ul>
<li>本案例接线方式<ul>
<li>灌电流。蜂鸣器一端接P1.0</li>
</ul>
</li>
</ul>
</li>
<li><p>因为人耳识别声音的范围为5Hz~20kHz，所以延迟最大为100ms</p>
</li>
</ul>
<h3 id="软件延迟实现蜂鸣器5Hz声音"><a href="#软件延迟实现蜂鸣器5Hz声音" class="headerlink" title="软件延迟实现蜂鸣器5Hz声音"></a>软件延迟实现蜂鸣器5Hz声音</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    P0_0 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        P0_0 = ~P0_0;</span><br><span class="line">        delay(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="定时-计数器实现蜂鸣器500Hz声音"><a href="#定时-计数器实现蜂鸣器500Hz声音" class="headerlink" title="定时&#x2F;计数器实现蜂鸣器500Hz声音"></a>定时&#x2F;计数器实现蜂鸣器500Hz声音</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 指定开启定时计数器0中断</span></span><br><span class="line">    IE = <span class="number">0x82</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0指定模式</span></span><br><span class="line">    <span class="comment">// 指定门控信号为软件开启</span></span><br><span class="line">    <span class="comment">// 指定工作在定时模式</span></span><br><span class="line">    <span class="comment">// 指定工作方式3</span></span><br><span class="line">    TMOD = <span class="number">0x01</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0指定时间初值（1ms=1000次）</span></span><br><span class="line">    TH0 = (<span class="number">65536</span> - <span class="number">1000</span>) / <span class="number">256</span>;</span><br><span class="line">    TL0 = (<span class="number">65536</span> - <span class="number">1000</span>) % <span class="number">256</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0开启计数</span></span><br><span class="line">    TR0 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="comment">// 初始蜂鸣器</span></span><br><span class="line">    P1_0 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">timer0</span><span class="params">(<span class="type">void</span>)</span> __interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 阻止计数</span></span><br><span class="line">    TR0 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 业务代码</span></span><br><span class="line">    <span class="keyword">if</span> (P1_0) P1_0 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> P1_0 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新指定计数初值</span></span><br><span class="line">    TH0 = (<span class="number">65536</span> - <span class="number">1000</span>) / <span class="number">256</span>;</span><br><span class="line">    TL0 = (<span class="number">65536</span> - <span class="number">1000</span>) % <span class="number">256</span>;</span><br><span class="line">    <span class="comment">// 恢复计数</span></span><br><span class="line">    TR0 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="定时-计数器实现蜂鸣器指定频率声音"><a href="#定时-计数器实现蜂鸣器指定频率声音" class="headerlink" title="定时&#x2F;计数器实现蜂鸣器指定频率声音"></a>定时&#x2F;计数器实现蜂鸣器指定频率声音</h3><blockquote>
<p><code>&lt;frequency&gt;</code>：频率</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 指定开启定时计数器0中断</span></span><br><span class="line">    IE = <span class="number">0x82</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0指定模式</span></span><br><span class="line">    <span class="comment">// 指定门控信号为软件开启</span></span><br><span class="line">    <span class="comment">// 指定工作在定时模式</span></span><br><span class="line">    <span class="comment">// 指定工作方式3</span></span><br><span class="line">    TMOD = <span class="number">0x01</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0指定时间初值（1ms=1000次）</span></span><br><span class="line">    TH0 = (<span class="number">65536</span> - <span class="number">1000000</span>/&lt;frequency&gt;/<span class="number">2</span>) / <span class="number">256</span>;</span><br><span class="line">    TL0 = (<span class="number">65536</span> - <span class="number">1000000</span>/&lt;frequency&gt;/<span class="number">2</span>) % <span class="number">256</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0开启计数</span></span><br><span class="line">    TR0 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="comment">// 初始蜂鸣器</span></span><br><span class="line">    P1_0 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">timer0</span><span class="params">(<span class="type">void</span>)</span> __interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 阻止计数</span></span><br><span class="line">    TR0 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 业务代码</span></span><br><span class="line">    <span class="keyword">if</span> (P1_0) P1_0 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> P1_0 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新指定计数初值</span></span><br><span class="line">    TH0 = (<span class="number">65536</span> - <span class="number">1000000</span>/&lt;frequency&gt;/<span class="number">2</span>) / <span class="number">256</span>;</span><br><span class="line">    TL0 = (<span class="number">65536</span> - <span class="number">1000000</span>/&lt;frequency&gt;/<span class="number">2</span>) % <span class="number">256</span>;</span><br><span class="line">    <span class="comment">// 恢复计数</span></span><br><span class="line">    TR0 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="定时-计数器实现蜂鸣器音阶"><a href="#定时-计数器实现蜂鸣器音阶" class="headerlink" title="定时&#x2F;计数器实现蜂鸣器音阶"></a>定时&#x2F;计数器实现蜂鸣器音阶</h3><ul>
<li>全音符的音长大约在1600ms</li>
<li>2分音符的音长大约在800ms</li>
<li>4分音符的音长大约在400ms（~600ms）</li>
<li>8分音符的音长大约在200ms</li>
<li>16分音符的音长大约在100ms</li>
<li>32分音符的音长大约在50ms</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 存放寄存器高位</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> h;</span><br><span class="line"><span class="comment">// 存放寄存器低位</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> l;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 指定开启定时计数器0中断</span></span><br><span class="line">    IE = <span class="number">0x82</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0指定模式</span></span><br><span class="line">    <span class="comment">// 指定门控信号为软件开启</span></span><br><span class="line">    <span class="comment">// 指定工作在定时模式</span></span><br><span class="line">    <span class="comment">// 指定工作方式3</span></span><br><span class="line">    TMOD = <span class="number">0x01</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="comment">// 初始蜂鸣器</span></span><br><span class="line">    P1_0 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// C大调中音7音阶数组</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> pitch[] = &#123;<span class="number">523</span>, <span class="number">587</span>, <span class="number">659</span>, <span class="number">698</span>, <span class="number">784</span>, <span class="number">880</span>, <span class="number">988</span>&#125;;</span><br><span class="line">    <span class="comment">// 每次蜂鸣器发声的音调（C大调中音7音阶数组的索引）</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> tone[] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    <span class="comment">// 每次蜂鸣器发声的音长（4分音符的倍数）</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> rhythm[] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line">    <span class="comment">// 累加器</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        h = (<span class="number">65536</span> - <span class="number">1000000</span>/pitch[tone[i] - <span class="number">1</span>]/<span class="number">2</span>) / <span class="number">256</span>;</span><br><span class="line">        l = (<span class="number">65536</span> - <span class="number">1000000</span>/pitch[tone[i] - <span class="number">1</span>]/<span class="number">2</span>) % <span class="number">256</span>;</span><br><span class="line">        <span class="comment">// 为定时/计数器0指定时间初值（1ms=1000次）</span></span><br><span class="line">        TH0 = h;</span><br><span class="line">        TL0 = l;</span><br><span class="line">        <span class="comment">// 为定时/计数器0开启计数</span></span><br><span class="line">        TR0 = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 延迟总音长（4分音符的倍数 * 4分音符的音长）</span></span><br><span class="line">        delay(rhythm[i] * <span class="number">600</span>);</span><br><span class="line">        <span class="comment">// 为定时/计数器0关闭计数</span></span><br><span class="line">        TR0 = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 蜂鸣器断电</span></span><br><span class="line">        P1_0 = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 累加器增加</span></span><br><span class="line">        i += <span class="number">1</span>;</span><br><span class="line">        i %= <span class="keyword">sizeof</span>(tone)/<span class="keyword">sizeof</span>(tone[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">timer0</span><span class="params">(<span class="type">void</span>)</span> __interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 阻止计数</span></span><br><span class="line">    TR0 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 业务代码</span></span><br><span class="line">    <span class="keyword">if</span> (P1_0) P1_0 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> P1_0 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新指定计数初值</span></span><br><span class="line">    TH0 = h;</span><br><span class="line">    TL0 = l;</span><br><span class="line">    <span class="comment">// 恢复计数</span></span><br><span class="line">    TR0 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="C大调音符频率对照表"><a href="#C大调音符频率对照表" class="headerlink" title="C大调音符频率对照表"></a>C大调音符频率对照表</h4><ul>
<li>中音的频率约定于2倍的低音</li>
<li>高音的频率约定于2倍的中音</li>
<li>以此类推</li>
</ul>
<table>
<thead>
<tr>
<th>序号</th>
<th>音符</th>
<th>频率</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>低音1</td>
<td>262</td>
</tr>
<tr>
<td>2</td>
<td>低音2</td>
<td>294</td>
</tr>
<tr>
<td>3</td>
<td>低音3</td>
<td>330</td>
</tr>
<tr>
<td>4</td>
<td>低音4</td>
<td>349</td>
</tr>
<tr>
<td>5</td>
<td>低音5</td>
<td>392</td>
</tr>
<tr>
<td>6</td>
<td>低音6</td>
<td>440</td>
</tr>
<tr>
<td>7</td>
<td>低音7</td>
<td>494</td>
</tr>
<tr>
<td>8</td>
<td>中音1</td>
<td>523</td>
</tr>
<tr>
<td>9</td>
<td>中音2</td>
<td>587</td>
</tr>
<tr>
<td>10</td>
<td>中音3</td>
<td>659</td>
</tr>
<tr>
<td>11</td>
<td>中音4</td>
<td>698</td>
</tr>
<tr>
<td>12</td>
<td>中音5</td>
<td>784</td>
</tr>
<tr>
<td>13</td>
<td>中音6</td>
<td>880</td>
</tr>
<tr>
<td>14</td>
<td>中音7</td>
<td>988</td>
</tr>
<tr>
<td>15</td>
<td>高音1</td>
<td>1046</td>
</tr>
<tr>
<td>16</td>
<td>高音2</td>
<td>1175</td>
</tr>
<tr>
<td>17</td>
<td>高音3</td>
<td>1318</td>
</tr>
<tr>
<td>18</td>
<td>高音4</td>
<td>1397</td>
</tr>
<tr>
<td>19</td>
<td>高音5</td>
<td>1568</td>
</tr>
<tr>
<td>20</td>
<td>高音6</td>
<td>1760</td>
</tr>
<tr>
<td>21</td>
<td>高音7</td>
<td>1976</td>
</tr>
</tbody></table>
<h2 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="/302.html?target=https://www.bilibili.com/video/BV1Mb411e7re/">哔哩哔哩——江科大自化协</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div><svg class="coin" width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.045 25.5454C7.69377 25.5454 2.54504 20.3967 2.54504 14.0454C2.54504 7.69413 7.69377 2.54541 14.045 2.54541C20.3963 2.54541 25.545 7.69413 25.545 14.0454C25.545 17.0954 24.3334 20.0205 22.1768 22.1771C20.0201 24.3338 17.095 25.5454 14.045 25.5454ZM9.66202 6.81624H18.2761C18.825 6.81624 19.27 7.22183 19.27 7.72216C19.27 8.22248 18.825 8.62807 18.2761 8.62807H14.95V10.2903C17.989 10.4444 20.3766 12.9487 20.3855 15.9916V17.1995C20.3854 17.6997 19.9799 18.1052 19.4796 18.1052C18.9793 18.1052 18.5738 17.6997 18.5737 17.1995V15.9916C18.5667 13.9478 16.9882 12.2535 14.95 12.1022V20.5574C14.95 21.0577 14.5444 21.4633 14.0441 21.4633C13.5437 21.4633 13.1382 21.0577 13.1382 20.5574V12.1022C11.1 12.2535 9.52148 13.9478 9.51448 15.9916V17.1995C9.5144 17.6997 9.10883 18.1052 8.60856 18.1052C8.1083 18.1052 7.70273 17.6997 7.70265 17.1995V15.9916C7.71158 12.9487 10.0992 10.4444 13.1382 10.2903V8.62807H9.66202C9.11309 8.62807 8.66809 8.22248 8.66809 7.72216C8.66809 7.22183 9.11309 6.81624 9.66202 6.81624Z" fill="currentColor"></path></svg></div>
  <button>
    储钱罐
  </button>
  <div class="post-reward">
      <div>
        <img src="/assets/images/reward/images/wxpay.png" alt="57uv6Z6g 微信支付">
        <span>微信支付</span>
      </div>
      <div>
        <img src="/assets/images/reward/images/alipay.png" alt="57uv6Z6g 支付宝">
        <span>支付宝</span>
      </div>
      <div>
        <img src="/assets/images/reward/images/qqpay.png" alt="57uv6Z6g qqpay">
        <span>qqpay</span>
      </div>
      <div>
        <img src="/assets/images/reward/images/bitcoin.png" alt="57uv6Z6g 比特币">
        <span>比特币</span>
      </div>
      <div>
        <img src="/assets/images/reward/images/ethereum.png" alt="57uv6Z6g ethereum">
        <span>ethereum</span>
      </div>
      <div>
        <img src="/assets/images/reward/images/monero.png" alt="57uv6Z6g monero">
        <span>monero</span>
      </div>
      <div>
        <img src="/assets/images/reward/images/paypal.png" alt="57uv6Z6g 贝宝">
        <span>贝宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Microcontroller/" rel="tag"># Microcontroller</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/10/18/Windows%E4%B8%8A%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91C51%E7%A8%8B%E5%BA%8F/" rel="prev" title="【笔记】Windows上手动编译C51程序">
                  <i class="fa fa-angle-left"></i> 【笔记】Windows上手动编译C51程序
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/10/18/MacOS%E7%9A%84QuickLook%E5%BF%AB%E9%80%9F%E6%9F%A5%E7%9C%8B/" rel="next" title="【笔记】MacOS的QuickLook快速查看">
                  【笔记】MacOS的QuickLook快速查看 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments"><div id="twikoo-comments"></div></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">57uv6Z6g</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>
<div id="site-time"></div>


<div id="current-visitors-count"></div>


<div id="site-badge"></div>


<div id="loading-door-left"></div>
<div id="loading-door-right"></div>
<a id="loading-door-a" href="javascript:loadingDoorOpen();">芝麻开门</a>


<div id="waifu">
  <div id="waifu-tips"></div>
  <canvas id="live2d" width="800" height="800"></canvas>
</div>
<div id="waifu-toggle">
  <span>看板娘</span>
</div>


<link rel="stylesheet" href="/dist/bundle.css">


<script src="/dist/bundle.js"></script>


    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script class="next-config" data-name="twikoo" type="application/json">{"enable":true,"visitor":false,"envId":"https://twikoo.loli.fj.cn","jsUrl":"https://unpkg.com/twikoo@1.6.44/dist/twikoo.min.js","el":"#twikoo-comments"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.twikoo.el)
    .then(() => NexT.utils.getScript(
      CONFIG.twikoo.jsUrl || 'https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js',
      { condition: window.twikoo }
    ))
    .then(() => {
      twikoo.init(CONFIG.twikoo);
    });
});
</script>
<style>
.post-block, .comments {
  overflow: visible;
}
.tk-owo-emotion {
  display: inline-block;
}
</style>

</body>
</html>
